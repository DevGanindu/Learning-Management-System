// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// User model - Base authentication
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  password     String
  name         String
  phone        String?
  profileImage String?
  role         Role     @default(STUDENT)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  student   Student?
  materials Material[]

  @@map("users")
}

// Student profile
model Student {
  id                 String    @id @default(cuid())
  studentId          String    @unique  // Auto-generated: STU-YYYY-XXXXX
  userId             String    @unique
  gradeId            String
  birthday           DateTime?
  address            String?
  parentName         String?
  parentPhone        String?
  approvalStatus     String    @default("PENDING") // PENDING, APPROVED, REJECTED
  approvedAt         DateTime?
  approvedBy         String?   // Admin user ID who approved
  enrollmentDate     DateTime  @default(now())
  isActive           Boolean   @default(true)
  lockedDueToPayment Boolean   @default(false)

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  grade    Grade     @relation(fields: [gradeId], references: [id])
  payments Payment[]

  @@map("students")
}

// Grade levels (6-11)
model Grade {
  id        String     @id @default(cuid())
  level     Int        @unique // 6, 7, 8, 9, 10, 11
  name      String     // "Grade 6", "Grade 7", etc.
  createdAt DateTime   @default(now())

  students  Student[]
  materials Material[]

  @@map("grades")
}

// Learning materials
model Material {
  id           String       @id @default(cuid())
  title        String
  description  String?
  type         MaterialType
  fileUrl      String?      // For PDFs and DOCs
  link         String?      // For YouTube and online class links
  gradeId      String
  uploadedById String
  uploadedAt   DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  grade    Grade @relation(fields: [gradeId], references: [id], onDelete: Cascade)
  uploader User  @relation(fields: [uploadedById], references: [id])

  @@map("materials")
}

// Payment records
model Payment {
  id        String        @id @default(cuid())
  studentId String
  amount    Float
  month     Int           // 1-12
  year      Int
  status    PaymentStatus @default(UNPAID)
  paidDate  DateTime?
  dueDate   DateTime      // Payment due date
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, month, year])
  @@map("payments")
}

// Enums
enum Role {
  ADMIN
  TEACHER
  STUDENT
}

enum MaterialType {
  PDF
  DOC
  YOUTUBE
  ONLINE_CLASS
}

enum PaymentStatus {
  PAID
  UNPAID
}
